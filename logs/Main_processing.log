#### SPECIALS LOG FILE #####
Created: 2020/01/27
Author: Guillermo Reales

Description: This file is intended to log all changes implemented to special files prior to further processing, as well as any relevant information about particular files for reproducibility and better debugging down the line.
Note that this file was started after initial file processing, so it may not be comprehensive in terms of including everything the files went through from download to projected.
For more information about specific files, please check Main_GWAS_table and README files in 99-Technical_useful_files/

- ADHD_LaskySu_18937294_1-fc.tsv.gz

Last reviewed: 2020-01-27
The problem with this file is REF/ALT assignment.
After revising it, it's still unclear which one is the effect allele.
Skipped for now 


- ADHD_Neale_20732625_1-hc.tsv.gz

Last reviewed: 2020-01-27
The problem with this file was the lack of OR and BETA, so they were calculated using Zscore, frequencies and sample sizes.

I tried to calculate them following a publication, using the line below 

awk 'BEGIN {FS=OFS="\t"}NR==1{print $0, "BETA", "SE"}NR>1{if($8 != ".") {beta = $6/sqrt(2*$8*(1 - $8) * (5415 + ($6 ** 2))); se = 1/sqrt(2*$8*(1 - $8) * (5415 + ($6 ** 2))); print $0, beta, se; next} {print $0, "NA", "NA"}}' ADH_Neale_20732625_1-hc.tsv | head | column -t

However, I discussed with Chris that the best way to calculate beta and se would be:
se = sqrt( 1 / (2 * N * f * (1 - f) * s * (1 - s)) )
beta-hat = z * se
where N = total sample size, s= n.cases/N, f=MAF

However, the study included cases, controls, and trios, and it wasn't clear to me how to proceed.
Skipped until further discussion.


- EGPAANCAn_Lyons_doi101101491837_1-hc.tsv.gz, EGPA_Lyons_doi101101491837_1-hc.tsv.gz, & EGPAMPO_Lyons_doi101101491837_1-hc.tsv.gz

Last reviewed: 2020-01-27

The three files have the same problem: After looking at the paper and associated readme files, I couldn't determine beyond reasonable doubt REF/ALT alleles. 
On a side note, OR reported in the paper (Table 2) do not correspond to the BETA reported in the files.
Skipped until further discussion.


- ASTAO_Ferreira_30929738_1-hg38.tsv.gz & ASTCO_Ferreira_30929738_1-hg38.tsv.gz

Last reviewed: 2020-02-05

These files came with a typo in origin: OR was reported as BETA. 
I caught this typo at projection, and initially thought it was a problem of REF/ALT misassign (I chose ALLELE1 as ALT and ALLELE0 as REF, as was suggested by reading the paper), but then I realized what the true error was.
I first downloaded the files that can be found in 97-Archive, but after I while I discovered that there were harmonized versions in GWAS catalog, so I downloaded them and run the rest of the pipeline on them.
Later I realized this typo was not caught by the GWAS catalog guys, who wrongly flipped this fake Beta for some alleles.
I took the two files in 97-Archive/, renamed columns as
ALLELE1 -> ALT
ALLELE0 -> REF
A1FREQ -> ALT_FREQ
BETA -> OR
P_BOLT_LMM_INF -> P

zcat AOA_Ferreira_30929738_1.tsv.gz | sed -e 's/ALLELE1/ALT/' -e 's/ALLELE0/REF/' -e 's/A1FREQ/ALT_FREQ/' -e 's/BETA/OR/' -e 's/P_BOLT_LMM_INF/P/' | gzip > ASTAO_Ferreira_30929738_1.tsv.gz
zcat COA_Ferreira_30929738_1.tsv.gz | sed -e 's/ALLELE1/ALT/' -e 's/ALLELE0/REF/' -e 's/A1FREQ/ALT_FREQ/' -e 's/BETA/OR/' -e 's/P_BOLT_LMM_INF/P/' | gzip > ASTCO_Ferreira_30929738_1.tsv.gz

After this, I normally run full_pipeline-v2.sh on both files and updated them at 04-Liftovered


- Tian_28928442 files

Last reviewed: 2020-02-05

This files come in a very specific format, which require another file to provide the alleles and rsids.

I first copied them from Archive to 01-Renamed, which contained all pipeline files
cp 97-Archive/*Tian_28928442* ../01-Renamed/

Since these files are in the old system, I changed them to the new one (but only the ones which changed their denomination, to avoid self-overwriting!)
mv CPX_Tian_28928442_1.tsv.gz CPOX_Tian_28928442_1.tsv.gz
mv HAV_Tian_28928442_1.tsv.gz HEPA_Tian_28928442_1.tsv.gz
mv HBV_Tian_28928442_1.tsv.gz HEPB_Tian_28928442_1.tsv.gz
mv MNU_Tian_28928442_1.tsv.gz IM_Tian_28928442_1.tsv.gz
mv MEA_Tian_28928442_1.tsv.gz MEAS_Tian_28928442_1.tsv.gz
mv MUM_Tian_28928442_1.tsv.gz MUMPS_Tian_28928442_1.tsv.gz
mv PNE_Tian_28928442_1.tsv.gz PNEU_Tian_28928442_1.tsv.gz
mv RHF_Tian_28928442_1.tsv.gz RFEV_Tian_28928442_1.tsv.gz
mv SCF_Tian_28928442_1.tsv.gz SCAF_Tian_28928442_1.tsv.gz
mv STT_Tian_28928442_1.tsv.gz STHR_Tian_28928442_1.tsv.gz
mv TBP_Tian_28928442_1.tsv.gz TBpos_Tian_28928442_1.tsv.gz
mv TON_Tian_28928442_1.tsv.gz TONS_Tian_28928442_1.tsv.gz
mv YEA_Tian_28928442_1.tsv.gz YINF_Tian_28928442_1.tsv.gz

I wrote a script to filter the annotation file from the original, and merge such file with Tian files (Fix_Tian_28928442_files.sh). 
After running this script, I delete the original files (in 01-Renamed) and run the full_pipeline-v2.sh on the new, merged ones.
Note: effect here means BETA, although in the paper they sometimes report OR or BETA, depending on the trait.


- ASTER_Ferreira_29083406_1-fc.tsv.gz, ASTE_Ferreira_29083406_1-fc.tsv.gz, ASTR_Ferreira_29083406_1-fc.tsv.gz, and RHEC_Ferreira_29083406_1-fc.tsv.gz.

Last Reviewed: 2020-02-06

These files came with the same issue as Tian_28928442 files, so the solution is the same.
I copied the original files from the Archive to 01-Renamed for processing.

cd 97-Archive/
cp AER_Ferreira_29083406_1.tsv.gz ASR_Ferreira_29083406_1.tsv.gz ASE_Ferreira_29083406_1.tsv.gz REC_Ferreira_29083406_1-fc.tsv.gz ../01-Renamed/
cd ../01-Renamed
mv ASE_Ferreira_29083406_1.tsv.gz ASTE_Ferreira_29083406_1.tsv.gz
mv AER_Ferreira_29083406_1.tsv.gz ASTER_Ferreira_29083406_1.tsv.gz
mv ASR_Ferreira_29083406_1.tsv.gz ASTR_Ferreira_29083406_1.tsv.gz
mv REC_Ferreira_29083406_1.tsv.gz RHEC_Ferreira_29083406_1.tsv.gz
./Fix_Ferreira_29083406_files.sh


- ALR_Ishigaki_doi101101795948_1

Last Reviewed: 2020-02-06

The problem with this file is that original data came in two files (one using autosomes, and other with X chromosome info).
I had merged these two files previously, but since they don't have the same number of columns, pipeline didn't work. 
Thus, I downloaded them again and reprocess:

wget jenger.riken.jp/88/
tar -xvf index.html
RScript --vanilla Remerge_Riken.R Pollinosis.auto.rsq07.mac10.txt.gz Pollinosis.chrx.rsq07.mac10.txt.gz ALR_Ishigaki_doi101101795948_1.tsv
sed -e 's/Allele1/REF/g' -e 's/Allele2/ALT/g' ALR_Ishigaki_doi101101795948_1.tsv | gzip > ALR_Ishigaki_doi101101795948_1.tsv.gz
./full_pipeline-v2.sh

I moved "unprocessed" file to Archive, and processed (hg38) to Processed.


- AST_Ishigaki_doi101101795948_1

Last Reviewed: 2020-02-06

The problem with this file is that original data came in two files (one using autosomes, and other with X chromosome info).
I had merged these two files previously, but since they don't have the same number of columns, pipeline didn't work. 
Thus, I downloaded them again and reprocess:

wget jenger.riken.jp/30/
tar -xvf index.html
Rscript --vanilla Remerge_Riken.R Asthma.auto.rsq07.mac10.txt.gz Asthma.chrx.rsq07.mac10.txt.gz AST_Ishigaki_doi101101795948_1.tsv
sed -e 's/Allele1/REF/g' -e 's/Allele2/ALT/g' AST_Ishigaki_doi101101795948_1.tsv | gzip > AST_Ishigaki_doi101101795948_1.tsv.gz
./full_pipeline-v2.sh

I moved "unprocessed" file to Archive, and processed (hg38) to Processed.

- ATD_Ishigaki_doi101101795948_1

Last Reviewed: 2020-02-06

The problem with this file is that original data came in two files (one using autosomes, and other with X chromosome info).
I had merged these two files previously, but since they don't have the same number of columns, pipeline didn't work. 
Thus, I downloaded them again and reprocess:

wget jenger.riken.jp/32/
tar -xvf index.html
Rscript --vanilla Remerge_Riken.R AD.auto.rsq07.mac10.txt.gz AD.chrx.rsq07.mac10.txt.gz ATD_Ishigaki_doi101101795948_1.tsv
sed -e 's/Allele1/REF/g' -e 's/Allele2/ALT/g' ATD_Ishigaki_doi101101795948_1.tsv | gzip > ATD_Ishigaki_doi101101795948_1.tsv.gz
./full_pipeline-v2.sh

I moved "unprocessed" file to Archive, and processed (hg38) to Processed.



- RA_Ishigaki_doi101101795948_1

Last Reviewed: 2020-02-07

The problem with this file is that original data came in two files (one using autosomes, and other with X chromosome info).
I had merged these two files previously, but since they don't have the same number of columns, pipeline didn't work. 
Thus, I downloaded them again and reprocess:

wget jenger.riken.jp/93/;
tar -xvf index.html
Rscript --vanilla Remerge_Riken.R RA.auto.rsq07.mac10.txt.gz RA.chrx.rsq07.mac10.txt.gz RA_Ishigaki_doi101101795948_1.tsv;
sed -e 's/Allele1/REF/g' -e 's/Allele2/ALT/g' RA_Ishigaki_doi101101795948_1.tsv | gzip > RA_Ishigaki_doi101101795948_1.tsv.gz;
./full_pipeline-v2.sh;

I moved "unprocessed" file to Archive, and processed (hg38) to Processed.


- T2D_Ishigaki_doi101101795948_1

Last Reviewed: 2020-02-07

The problem with this file is that original data came in two files (one using autosomes, and other with X chromosome info).
I had merged these two files previously, but since they don't have the same number of columns, pipeline didn't work. 
Thus, I downloaded them again and reprocess:

wget jenger.riken.jp/95/;
tar -xvf index.html
Rscript --vanilla Remerge_Riken.R T2D.auto.rsq07.mac10.txt.gz T2D.chrx.rsq07.mac10.txt.gz T2D_Ishigaki_doi101101795948_1.tsv;
sed -e 's/Allele1/REF/g' -e 's/Allele2/ALT/g' T2D_Ishigaki_doi101101795948_1.tsv | gzip > T2D_Ishigaki_doi101101795948_1.tsv.gz;
./full_pipeline-v2.sh;

I moved "unprocessed" file to Archive, and processed (hg38) to Processed.


- CDP_Lee_28067912_1

Last Reviewed: 2020-02-07

The problem with this file is that my early scripts messed up with it, leaving bottom rows in a crazy state. 
Thus, I downloaded it again and reprocessed it.

wget ftp://ftp.ebi.ac.uk/pub/databases/gwas/summary_statistics/LeeJC_28067912_GCST004053/CD_prognosis_GWA_results.csv.zip
unzip CD_prognosis_GWA_results.csv.zip
mv CD_prognosis_GWA_results.csv CDP_Lee_28067912_1.tsv

I realised when running the pipeline that some BP positions had scientific notation, which made liftover get stuck. I fixed this like this, include this check in v3 of the pipeline

cat CDP_Lee_28067912_1.tsv | awk 'BEGIN{FS=OFS="\t"}NR>1{$3=sprintf("%i", $3)}7' | gzip > CDP_Lee_28067912_1.tsv.gz
mv CDP_Lee_28067912_1.tsv.gz ../97-Archive/

From the paper, I inferred that allele_A is REF and allele_B is ALT. I manually edited the file using vim prior to pipeline
In addition, some unexpected bug at processing liftover results made merge to fail.
Specifically, when converting from *-lo_output.bed to *-lo_output2.bed, sed removes chr from lo-output.bed. This is because liftOver needs CHR to have "chr"+number, while our files don't.
However, in this particular file, instead of having traditional rs00000 format, we have chrCHR:BP format. Thus, that sed removes "chr" from SNPID column too, preventing a correct merge.
I did the following to correct it, and included it in version v3 of the pipeline.


awk 'BEGIN{FS=OFS="\t"}{sub("chr", "",$1); print $4,$1,$2}' CDP_Lee_28067912_1-lo-output.bed | sed '1i SNPID\tCHR38\tBP38' > CDP_Lee_28067912_1-lo-output2.bed 
join -a2 -e'NA' -t $'\t' --nocheck-order -o auto CDP_Lee_28067912_1-lo-output2.bed tmp_formerging1.tsv | gzip  > CDP_Lee_28067912_1-hg38.tsv.gz


- T2D_Gaulton_26551672_1

Last Reviewed: 2020-02-11

I decided to redownload and reprocess this file because some undetermined bug (probably at liftover step) made me sent it to Specials
Something strange happened when I redownloaded the file from https://diagram-consortium.org/downloads.html (DIAGRAM Metabochip meta-analysis of T2D: Summary Statistics Published in Gaulton et al., Nature Genetics, 2015): The file didn't correspond to the file I had in 97-Archive.
In particular, this new downloaded file has way less SNPs (45943) compared to 127903 for the older.
Interesting, the README file I already had in 99-Technical_useful_files/ matched the Readme file associated to this new file.
I investigated this, including checking if perhaps they changed the available file for download, or if I downloaded it from GWAS catalog instead. Both questions turned out to be negative.
After checking the data in the paper and both the new and old T2D_Gaulton file, I determined to use the new file, since the numbers matched better the paper.
Thus, I manually edited the header, which was a bit messed up, and processed it. I kept the old T2D_Gaulton file in Archive for future inquiry.

However, this file still lacks SE, and will need to be calculated, so it went to Files_with_SE_issues

I also noticed that P was in scientific notation, and some of them didn't have even the E (see below):

               SNPID CHR38      BP38 CHR        BP ALT REF ALT_FREQ    OR OR_95L OR_95U       P N_EFFECTIVE     BETA
1:        rs34872471    10 112994312  10 114754071   C   T    0.261 1.386  1.348  1.425 5.3-119    73902.19 0.326422
2:        rs35198068    10 112995025  10 114754784   C   T    0.261 1.387  1.349  1.426 3.4-119    73902.22 0.327143
3:         rs7903146    10 112998590  10 114758349   T   C    0.260 1.388  1.351  1.427 5.8-120    73902.25 0.327864
4:        rs36090025    10 113014674  10 114774433   C   A    0.269 1.363  1.326  1.401 9.7-108    73901.87 0.309688
5: chr10:114782581:I    10 113022822  10 114782581   I   R    0.259 1.364  1.326  1.403 5.3-105    73901.98 0.310422
6:         rs7074440    10 113025665  10 114785424   A   G    0.269 1.356  1.320  1.394 4.2-105    73902.25 0.304539

I manually included the E using vim.


- VITD_Manousaki_28757204_1

Last Reviewed: 2020-02-10

The problem with this file is that it had some genomic coordinates expressed in scientific notation, making the LiftOver executable to crash.
As of pipeline v3, I included a line to replace these cases, so now it should work.
I took the file in Archive (VDL_Manousaki...), changed reference_allele to ALT and other_allele to REF, following the file's README at 99, and pipelined with v3.


- PSC_Ji_27992413_1

Last Reviewed: 2020-02-10

The problem with this file was that had a BETA column, but for some reason it was all NA. Since it had the headers, the bug run unnoticed.
To solve this, I used the following code

zcat PSC_Ji_27992413_1-hg38.tsv.gz | awk 'BEGIN{FS=OFS="\t"}NR>1{$26=log($22)}1' | gzip > PSC_Ji_27992413_1-bcorr.tsv.gz
cp PSC_Ji_27992413_1-bcorr.tsv.gz ../02-Processed/PSC_Ji_27992413_1-hg38.tsv.gz 
mv PSC_Ji_27992413_1-bcorr.tsv.gz ../To_reproject/PSC_Ji_27992413_1-hg38.tsv.gz


- RA_Okada_24390342_1 and RA_Okada_24390342_2 

Last Reviewed: 2020-02-10

These files lacked SE. While checking them at this stage, I realized that some positions hadn't been liftovered properly, probably due to bugs in previous versions of the pipeline.
So I repipelined them under v3 prior to SE calculation.
SE was successfully calculated using SE_Calc.R

- RA_Okada_24390342_3

Last Reviewed: 2020-02-10

The problem with this file was that had a BETA and SE columns, but for some reason they were both all NA. Since it had the headers, the bug run unnoticed.
To solve this, I used the following code

zcat RA_Okada_24390342_3-hg38.tsv.gz | awk 'BEGIN{FS=OFS="\t"}NR>1{$24=log($18)}1' | gzip > RA_Okada_24390342_3-bcorr.tsv.gz

For the SE calculation, I used SE_Calc.R on it



- Enroth_25147954

Last Reviewed: 2020-05-06

These files had SE missing. I realized that for some reason liftOver failed in these files, so I copied them from Archive, re-encoded allelles (A1 = ALT, A2 = REF) and repipelined.

mv B001_Enroth_25147954_1.tsv.gz CCL19_Enroth_25147954_1.tsv.gz
mv B002_Enroth_25147954_1.tsv.gz EOT2_Enroth_25147954_1.tsv.gz
mv B003_Enroth_25147954_1.tsv.gz CD40_Enroth_25147954_1.tsv.gz
mv B004_Enroth_25147954_1.tsv.gz IP10_Enroth_25147954_1.tsv.gz
mv B005_Enroth_25147954_1.tsv.gz CXCL5_Enroth_25147954_1.tsv.gz
mv B006_Enroth_25147954_1.tsv.gz EPCAM_Enroth_25147954_1.tsv.gz
mv B007_Enroth_25147954_1.tsv.gz ESEL_Enroth_25147954_1.tsv.gz
mv B008_Enroth_25147954_1.tsv.gz IL12_Enroth_25147954_1.tsv.gz
mv B009_Enroth_25147954_1.tsv.gz IL17RB_Enroth_25147954_1.tsv.gz
mv B010_Enroth_25147954_1.tsv.gz IL6RA_Enroth_25147954_1.tsv.gz
mv B011_Enroth_25147954_1.tsv.gz K11_Enroth_25147954_1.tsv.gz
mv B012_Enroth_25147954_1.tsv.gz MIA_Enroth_25147954_1.tsv.gz
mv B013_Enroth_25147954_1.tsv.gz MICA_Enroth_25147954_1.tsv.gz
mv B014_Enroth_25147954_1.tsv.gz VEGFD_Enroth_25147954_1.tsv.gz

In addition, I noticed a bug in the pipeline that would wrongly rename "sebeta_add_snp" as BETA. This was corrected in v4.3. I repipelined the files.

On May 2020, I aligned these datasets alleles to a reference panel (1000 genomes Project), and sdY-adjusted them, using the maf column provided (renamed ALT_FREQ, after I checked it refers to ALT). I used Compute_Enroth_Freqs.sh (used in other cases for extracting allele frequencies, but I used here for panel allele retrieving only) and Enroth_adjust_align.R. After this, I used those files for our meta-analysis of cytokine levels, and re-projected them onto our three bases, too.

- MS_IMSGC_31604244_1

Last Reviewed: 2020-02-11

This file had SE missing. I realized that for some reason liftOver failed in this files, so I copied it from Archive, re-encoded allelles (A1 = ALT, A2 = REF) and repipelined.




- AIS_Kou_31417091_1, CD_Brant_27693347_1, EOE_Kottyan_25017104_1, IBD_Brant_27693347_1, IGAD_Bronson_27723758_1, MDD_CONVERGE_26176920_1, MS_IMSGC_30343897_1, MTX_Taylor_29795407_1, NMO_Estrada_29769526_1, NMOIGGn_Estrada_29769526_1, NMOIGGp_Estrada_29769526_1, PSO_Hirata_29031612_1, RA_Okada_24390342_1, RA_Okada_24390342_2, SLE_Julia_29848360_2, T2D_DIAGRAM_24509480_1, T2D_Gaulton_26551672_1, T2D_Morris_22885922_1, &  UC_Brant_27693347_1

Last Reviewed: 2020-02-11

These files lacked SE. I calculated it using SE_Calc.


- MDD_Wray_29700475_1

Last Reviewed: 2020-02-15

This file had a couple of problems. First, I mistakenly converted ';' (found in some SNPIDs) to tabs in the first versions of the pipeline, messing with the file structure. This was corrected by re-running. However, as explained in the Readme file, there are 62 SNPs in the middle of the file that are separated by spaces instead of tabs, and with less columns (12). Since the columns were in the same order than the rest of the file, I filled the missing columns in these 62 SNPs by NA using the following line. I repipelined afterwards. I updated the file in 97-Archive too.

zcat MDD_Wray_29700475_1.tsv.gz | awk 'BEGIN{OFS="\t"}{ for(i=NF+1; i<=19; i++) $i = "NA"; print}'  > tmp.tsv
gzip tmp.tsv && mv tmp.tsv.gz MDD_Wray_29700475_1.tsv.gz


- MSC_IMSGC_24076602_1

Last Reviewed: 2020-02-17

This file had two BP columns (18 and 19 builds). The 19 build was chosen for overlift, but it had some "unmapped" positions, while it had these positions for hg18.
I removed the hg19 column, renamed bp18 and reprocessed the file.

cp ../97-Archive/MSC_IMSGC_24076602_1.tsv.gz MS_IMSGC_24076602_1.tsv.gz
zcat MS_IMSGC_24076602_1.tsv.gz | awk '{$0=gensub(/\s*\S+/,"",3)}1' | sed '1s/BP18//' | gzip > tmp.tsv.gz && mv tmp.tsv.gz MS_IMSGC_24076602_1.tsv.gz


- SLE_SLEGEN_18204446_1.tsv.gz

Last Reviewed: 2020-02-20

For this file, it was unclear to me REF/ALT alleles. After a closer look at the paper, they call "Allele1" as minor allele, and OR seems to be referent to it, thus

cp ../97-Archive/SLE_SLEGEN_18204446_1.tsv.gz ./
zcat SLE_SLEGEN_18204446_1.tsv.gz | sed -e 's/Allele1/ALT/' -e 's/Allele2/REF/' | gzip > tmp.tsv.gz && mv tmp.tsv.gz SLE_SLEGEN_18204446_1.tsv.gz

And reprocessed the file.
During reduction, we realised that this file had a one-off error in it, rendering matches with manifest be zero.
Thus

cp ../97-Archive/SLE_SLEGEN_18204446_1.tsv.gz ./
zcat SLE_SLEGEN_18204446_1.tsv.gz | sed -e 's/Allele1/ALT/' -e 's/Allele2/REF/' | awk 'BEGIN{FS=OFS="\t"}!$4{$4 = "NA"}NR>1{if($4 != "NA") $4 = ($4 +1)}1' | gzip > tmp.tsv.gz && mv tmp.tsv.gz SLE_SLEGEN_18204446_1.tsv.gz

And reprocessed the file.


- PSO_Feng_19680446_1.tsv.gz

Last Reviewed: 2020-02-20

For this file, it was unclear to me REF/ALT alleles. After a closer look at the paper, OR seems to be referring to  "Allele1" thus

cp ../97-Archive/PSO_Feng_19680446_1.tsv.gz ./
zcat PSO_Feng_19680446_1.tsv.gz | sed -e 's/Allele1/ALT/' -e 's/Allele2/REF/' | gzip > tmp.tsv.gz && mv tmp.tsv.gz PSO_Feng_19680446_1.tsv.gz

And reprocessed the file.

During reduction, we realised that this file had a one-off error in it, rendering matches with manifest be zero.
Thus

cp ../97-Archive/PSO_Feng_19680446_1.tsv.gz ./
zcat PSO_Feng_19680446_1.tsv.gz | sed -e 's/Allele1/ALT/' -e 's/Allele2/REF/' | awk 'BEGIN{FS=OFS="\t"}!$4{$4 = "NA"}NR>1{if($4 != "NA") $4 = ($4 +1)}1' | gzip > tmp.tsv.gz && mv tmp.tsv.gz PSO_Feng_19680446_1.tsv.gz

And reprocessed the file using v4.
Because some SNPs lacked BP coordinates (and thus failed liftover), the join function behaved unexpectedly, not being able to match a number of SNPs (~800) despite having hg38 build coordinates in *lo-output2.bed.
I tried several things, including reordering files by SNPID, removing the initial missing SNPs...but I still couldn't understand what happened. 
The best I could get was by removing all SNPs with 0 at BP and then join. This yields a file with 267 unmatched SNPs (there were supposed to be 78).
To reproduce this error, follow previous steps and run pipeline v4.
What I did to improve the situation:

join -a2 -e'NA' -t $'\t' --nocheck-order -o auto PSO_Feng_19680446_1-lo-output2.bed <(awk '$4 != 0' tmp_formerging1.tsv) | gzip > PSO_Feng_19680446_1-hg38.tsv.gz


- MCH_Astle_27863252_1-hg38.tsv.gz,  MCHC_Astle_27863252_1-hg38.tsv.gz,  MCHC_Kanai_29403010_1-hg38.tsv.gz, & MCH_Kanai_29403010_1-hg38.tsv.gz

Last Reviewed: 2020-02-20

I found a tiny wee confusion at the name paradigm change step, since at some point I thought they were the same trait (Spoiler alert: They're not). 
This led to files having exactly the same name and overwriting, so I decided to reprocess them from the outset. The change in names from v1 to v2 is as follows:
CHC -> MCHC (Mean Corpuscular Hemoglobin Concentration)
MCH -> MCH (Mean Corpuscular Hemoglobin). No change.


- VIT_Jin_27723757_1-hg38.tsv.gz

Last Reviewed: 2020-02-21

I had to reprocess this file because I realized that column order was different in Chr1 than in the rest.

cp ../97-Archive/VIT_Jin_27723757_1.tsv.gz ./
zcat VIT_Jin_27723757_1.tsv.gz | awk 'BEGIN{FS=OFS="\t"}NR<653613{print $1, $2, $3, $4, $6, $5, $7, $8, $9, $10, $11, $12}NR>=653613{print $0}' | sed -e '1s/MAF/REF/' -e '1s/A1/ALT/' -e '1s/A2/MAF/' -e 's/RS/rs/' > VIT_Jin_27723757_1.tsv
gzip VIT_Jin_27723757_1.tsv

And reprocessed the file
I took the chance to make some improvements in pipeline, and created v4.1.

In addition, I realized that BETA calculation failed for some Chrs at the pipeline step (I noticed when searching for common significant SNPs, VIT_Jin file had an unusual amount of SNPs with BETA == NA).
I loaded the file into R, recalculated BETA doing VIT$BETA <- log(VIT$OR), and updated the file at 02-Processed/

- IGAN_Kiryluk_25305756_1.tsv.gz

Last Reviewed: 2020-02-21

This trait is one of those used to create the basis. But its projection didn't match those of the original (IgA_Neph). 
Investigating the original file I realized that there are two allele columns (Ref and Alt, and Allele1 and Allele2), but Beta makes reference to Allele1, and since some alleles in the Ref Alt columns, which I used for my projections were flipped, I got many wrongly oriented betas.
Thus, I reprocessed the file, removing these troublesome columns.

cp ../97-Archive/IAN_Kiryluk_25305756_1.tsv.gz ./
mv IAN_Kiryluk_25305756_1.tsv.gz IGAN_Kiryluk_25305756_1.tsv.gz
zcat IGAN_Kiryluk_25305756_1.tsv.gz | cut -d$'\t' -f1-2,4,7- | sed -e '1s/Allele1/ALT/' -e 's/Allele2/REF/' | gzip > tmp.tsv.gz && mv tmp.tsv.gz IGAN_Kiryluk_25305756_1.tsv.gz

And reprocessed with v4.1


- CD/IBD/UC_Brant_27693347_1 files

Last Reviewed: 2020-02-24

These files called our attention when I made the first exploratory plots, since they didn't cluster as expected. 
After a bit of investigation, I realised REF/ALT assingment was wrong. In the paper, A1 is called "tested" allele, and A2 is the "alternate allele", which made me think that A1 was the effect allele.
However, A2 seems to be ALT and A1 seems to be REF. 

zcat IBD_Brant_27693347_1-hg38.tsv.gz | sed -e '1s/ALT/tmp/' -e '1s/REF/ALT/' -e '1s/tmp/REF/' | gzip > tmp.tsv.gz && mv tmp.tsv.gz IBD_Brant_27693347_1-hg38.tsv.gz
zcat CD_Brant_27693347_1-hg38.tsv.gz | sed -e '1s/ALT/tmp/' -e '1s/REF/ALT/' -e '1s/tmp/REF/' | gzip > tmp.tsv.gz && mv tmp.tsv.gz CD_Brant_27693347_1-hg38.tsv.gz
zcat UC_Brant_27693347_1-hg38.tsv.gz | sed -e '1s/ALT/tmp/' -e '1s/REF/ALT/' -e '1s/tmp/REF/' | gzip > tmp.tsv.gz && mv tmp.tsv.gz UC_Brant_27693347_1-hg38.tsv.gz


- ASD_ASDWGPGC_28540026

Last Reviewed: 2020-02-25

While checking BETA correlations, I realized that these files were inverted compared to ASD_Grove datasets.
This was confirmed by reading the readme. A1 was classified as REF, but the readme says 
# a1 ............ reference allele 
# a2 ............ alternate allele
# or ............ odds ratio - derived from "effect", based on reference allele
So A1 should be ALT, instead of REF, as it was.
I manually corrected this using vim, and re-reduced the files for reprojection.

- HPxx_Wang_30092202_1

Last Reviewed: 2020-03-16

These files belong to the H2P2 project. The problem with them was that I was unsure of which BETA and Standard error to use, since it came with the following headers

Chr = CHR
Pos = BP
(CHR38 added)
(BP38 added)
MajorA	= REF
MinorA	= ALT
Beta	= BETA
EMP_Beta = EMP_BETA
EMP_se = EMP_SE
EMP1 = EMP_P
SNP = SNPID

However, it wasn't clear to me which BETA to use. I re-read the paper, and they used the QFAM-parents approach with adaptive permutation and a maximum of 109 permutations. The QFAM procedures implemented in PLINK use linear regression to test for association while employing permutation of within- and between-family components separately to control for family structure.
In addition:
"Simulation were carried out to estimate the genome-wide significance thresholds for H2P2 traits. For each cellular traits, we permutated the phenotype and ran family based association analysis using ‘‘qfam-parents’’ in PLINK 1.9. 
Following Kanai et al., 2016, we calibrated the empirical genome-wide significance threshold using the minimum p value from each simulation. 
We calculated the 90th percentile of the empirical distribution of log10Pmin using the Harrel-Davis estimator (Harrel and Davis, 1982) at a = 0.1, and the 95% confidence intervals of the quantile were obtained using 10000 bootstraps.

I decided to use EMP_BETA, EMP_SE and EMP1 for a start, so I created an script (HP_reheader.sh) to rehead these files appropriatedly.

March update: After projecting these datasets, I realized that Betas differed wildly across studies, most likely due to different scales in measurement. To make them comparable among each other, we used a formula to scale both Beta and SE by their population variance, using an R function provided by Chris: 

sdY.est <- function(vbeta, maf, n) {
    warning("estimating sdY from maf and varbeta, please directly supply sdY if known")
    oneover <- 1/vbeta
    nvx <- 2 * n * maf * (1-maf)
    m <- lm(nvx ~ oneover - 1)
    cf <- coef(m)[['oneover']]
    if(cf < 0)
        stop("estimated sdY is negative - this can happen with small datasets, or those with errors.  A reasonable estimate of sdY is required to continue.")
    return(sqrt(cf))
}

However, these files didn't come with MAF - a required item for this function. So I had to calculate it.
For it I used 1000 genomes phase III data that I had previously downloaded, in order to extract allele frequencies for each SNP. I used Fix_HP_files.sh for that task.
Next, I used Adjusting_HP.R to calculate the factor, and divide Beta and SE in each fole for that factor.
Finally, I repipelined the files and reprojected them.


- PBC_Nakamura_23000144_1

Last Reviewed: 2020-03-05

The harmonized file in GWAS catalog had some issues, so I decided to download the original file (ftp://ftp.ebi.ac.uk/pub/databases/gwas/summary_statistics/NakamuraM_23000144_GCST001685/hum0076_1stgwas_160916.csv) again.
This file had some particularities regarding alleles. BETA/OR refers to the minor allele, which changes depending on the SNP, there's a column specifying which one is the minor allele. 
I fixed it using an Rscript named Fix_PBC_Nakamura_23000144.R and repipelined (v4.4).



- EGPA/EGPAANCAn/EGPAMPO_Lyons_31719529_1.tsv.gz

Last Reviewed: 2020-03-10

The OR/BETA in the paper didn't quite match the ones in the files, probably due to some treatment given to the files during processing. Olly suggested adjusting BETA by the proportion of cases vs. controls. I wrote a script for this called Fix_Lyons.R.
This script calculates the adjusted BETA, OR, and SE for this study.
After that, I replaced ALLELE1 by ALT, and ALLELE0 by REF, and reprocessed the files.


- T2D_Scott_28566273_1

Last Reviewed: 2020-06-29

This file had the issue of not having SNPIDs. Since we don't *need* ids to process the file, we'll separate the CHR and POS, and keep the CHRPOS column as SNPID. I used Fix_T2D_Scott_20566237.R for that.

UPDATE: I wasn't satisfied with the performance of the pipeline at the post-liftover merge. I used T2D_Scott as a test file, and I managed to improve it with less information loss (all rows kept, only NA in CHR38 and BP38 that failed to liftover). These changes were implemented in pipeline v5.0.
I updated de file in 02-Processed.



- SSC_LopezIsac_31672989

Last Reviewed: 2020-03-17

This file had only one allele. I extracted both alleles from 1000 genomes data and used the following two scripts to incorporate the other allele: extract-alleles-LopezIsac.sh and Fix_LopezIsac.R.


- Ferreira_19853236 blood cell count files

Last Reviewed: 2020-03-19

These files lacked one of the two alleles. Assuming that the reported allele is the effect allele, I was able to extract the list of SNPs, find both alleles at 1000g data, and compute the other allele for all files. For it I used two scripts:
- extract-alleles.sh
- fix-alleles.R
Then I repipelined (4.4) the files and re-reduced.


- UC_Julia_25082827_1

Last Reviewed: 2020-07-31

This file lacked one allele, and had its OR in the following structure: OR(95%CI), so I made a couple of changes prior to processing.
zcat UC_Julia_25082827_1.tsv.gz | sed -e 's/(/ /' -e 's/)//' -e 's/SNP/SNPID/' -e 's/MINOR_ALELE/ALT/' | gzip > tmp.tsv.gz && mv tmp.tsv.gz UC_Julia_25082827_1.tsv.gz

Update 2020-07-31: I noticed a flaw in my fix_one_allele_problem scripts, so I updated them. Then, I took UC_Julia_1 file in 02, removed REF and run the new scripts.
These scripts would allow for detection of not only flipped, but also complement and reverse-complement alleles. They will also remove ambiguous alleles.

- VITD_Traglia_32047095

Last Reviewed: 2020-07-31

These files lacked one allele too, so I processed them using the two scripts.
zcat VITD_Traglia_32047095_1.tsv.gz | sed -e '1s/RSID/SNPID/' -e '1s/A1/ALT/' -e 's/;/\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz VITD_Traglia_32047095_1.tsv.gz
zcat VITD_Traglia_32047095_2.tsv.gz | sed -e '1s/RSID/SNPID/' -e '1s/A1/ALT/' -e 's/;/\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz VITD_Traglia_32047095_2.tsv.gz;
zcat VITD_Traglia_32047095_3.tsv.gz | sed -e '1s/RSID/SNPID/' -e '1s/A1/ALT/' -e 's/;/\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz VITD_Traglia_32047095_3.tsv.gz;
zcat VITD_Traglia_32047095_4.tsv.gz | sed -e '1s/RSID/SNPID/' -e '1s/A1/ALT/' -e 's/;/\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz VITD_Traglia_32047095_4.tsv.gz

Update 2020-07-31: I noticed a flaw in my fix_one_allele_problem scripts, so I updated them. Then, I took UC_Julia_1 file in 02, removed REF and run the new scripts.
These scripts would allow for detection of not only flipped, but also complement and reverse-complement alleles. They will also remove ambiguous alleles.

- Ferreira_20045101

Last Reviewed: 2020-03-20

These files lacked one allele too, so I processed them using the two scripts.
I first update the name of the files
mv LT3_Ferreira_20045101_1.tsv.gz CD3TC_Ferreira_20045101_1.tsv.gz
mv R48_Ferreira_20045101_1.tsv.gz CD4CD8_Ferreira_20045101_1.tsv.gz
mv LT4_Ferreira_20045101_1.tsv.gz CD4TC_Ferreira_20045101_1.tsv.gz
mv LT8_Ferreira_20045101_1.tsv.gz CD8TC_Ferreira_20045101_1.tsv.gz
mv LB19_Ferreira_20045101_1.tsv.gz LB19C_Ferreira_20045101_1.tsv.gz
mv NK56_Ferreira_20045101_1.tsv.gz NK56C_Ferreira_20045101_1.tsv.gz

zcat CD3TC_Ferreira_20045101_1.tsv.gz | sed -e '1s/SNP/SNPID/' -e 's/A1/ALT/' -e 's/ /\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz CD3TC_Ferreira_20045101_1.tsv.gz
zcat CD4CD8_Ferreira_20045101_1.tsv.gz | sed -e '1s/SNP/SNPID/' -e 's/A1/ALT/' -e 's/ /\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz CD4CD8_Ferreira_20045101_1.tsv.gz
zcat CD4TC_Ferreira_20045101_1.tsv.gz | sed -e '1s/SNP/SNPID/' -e 's/A1/ALT/' -e 's/ /\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz CD4TC_Ferreira_20045101_1.tsv.gz
zcat CD8TC_Ferreira_20045101_1.tsv.gz | sed -e '1s/SNP/SNPID/' -e 's/A1/ALT/' -e 's/ /\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz CD8TC_Ferreira_20045101_1.tsv.gz
zcat LB19C_Ferreira_20045101_1.tsv.gz | sed -e '1s/SNP/SNPID/' -e 's/A1/ALT/' -e 's/ /\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz LB19C_Ferreira_20045101_1.tsv.gz
zcat NK56C_Ferreira_20045101_1.tsv.gz | sed -e '1s/SNP/SNPID/' -e 's/A1/ALT/' -e 's/ /\t/g' | gzip > tmp.tsv.gz && mv tmp.tsv.gz NK56C_Ferreira_20045101_1.tsv.gz
And processed them with the two scripts.
NOTE: I realized that I had downloaded the "harmonised" file from GWAS catalog for CD4CD8. This led to issues during processing, so I redownloaded the original file (ftp://ftp.ebi.ac.uk/pub/databases/gwas/summary_statistics/FerreiraMA_20045101_GCST000553/CD4_8.assoc.gz).


- RD_Boutin_31816047

Last Reviewed: 2020-04-30

This file appeared as an outlier in the N0N1Calc vs SE plot. In order to fix it I applied Fix_scales.R in 93-Fix_stuff
This script rightly identified the dataset as a case-control, and adjusted both BETA and SE by the proportion of cases, thus transforming to log-odds scale, while keeping original BETA and SE columns (orig.BETA, orig.SE).
The generated file replaced the -hg38.tsv.gz in 02-Processed.


- AAVMPO & AAVPR3 Wong unpublished files

Last Reviewed: 2020-04-30

This files were generated using BOLT-LMM, so I adjusted both BETA and SE columns in log-odds scale using Fix_scales.R in 93-Fix_stuff.


- Hoglund_31727947 files

Last Reviewed: 2020-05-06

These files didn't require much correction. I just aligned their alleles to the 1000 genomes project reference and sdY-adjusted them for our meta-analysis. For that I computed CEU frequencies for their SNPs and added a column, referring to the frequency of ALT (ALT_FREQ). From that I calculated sdY and divided BETA and SE by the resulting coefficient, keepoing original values (orig.*). I used Compute_Hoglund_freqs.sh and Hoglund_adjust_align.R for these tasks.



- AholaOlli_27989323 files

Last Reviewed: 2020-05-06

These files didn't require much correction. I just aligned their alleles to the 1000 genomes project reference and sdY-adjusted them for our meta-analysis. 
For that I computed FIN frequencies for their SNPs and added a column, referring to the frequency of ALT (ALT_FREQ). From that I calculated sdY and divided BETA and SE by the resulting coefficient, keepoing original values (orig.*). I used Compute_AholaOlli_freqs.sh and AholaOlli_adjust_align.R for these tasks.

- UKBB 20002 files

Last Reviewed: 2020-05-06

I downloaded all 20002 files and pre-filtered them by a SNP manifest common to all three bases. They didn't require much adjustment, but when we projected them we realized that something wasn't quite right (N0N1Calc vs SE plot), so we decided to convert the BETA and SE scale from linear (as these files were generated in BOLT-LMM) to OR scale. I did this using Fix_scales.R. Then reprojected.


- MDD_Howard_29662059

Last Reviewed: 2020-05-07

This dataset was generated using a linear model, so we had to convert those to OR scale. I did this with Fix_scales.R.
Then re-reduced and reprojected.


- RETC_Astle

Last Reviewed: 2020-05-08

I noticed that there was a file missing in the Astle collection (Reticulocyte count). I downloaded and added it, but this involved some changes in the naming system:
REC -> RETHLC (High light scatter reticulocyte count)
REPRC -> RETHLPRC (High light scatter reticulocyte percentage of red cells)
REFRC -> RETFRC (Reticulocyte fraction of red cells)
New denomination: RETC (Reticulocyte count)


- IMMED_Traglia_30134952

Last Reviewed: 2020-07-31

These 4 files contained data for multiple cytokines, as well as one-allele-only problem.
I wrote a script to first split them by cytokine (see 93-Fixing_stuff/Special_cases/...Traglia..), and them went through the cytokine names to check for the need to generate new traits in our dictionary or just rename the files. I  To make things easier, I renamed any cytokine that had an existing trait already in our dictionary (see names and equivalents in tableS2 in the paper).
These files also had the one-allele-problem, and only the effect allele was reported. To solve this I wrote a script (see 93-Fix_stuff/one-allele) and processed all files. 
Once I did this, I pipelined the files using v4.10.

Update 2020-07-31: I noticed a flaw in my fix_one_allele_problem scripts, so I updated them. Then, I took Traglia files in 02, removed REF and run the new scripts.
These scripts would allow for detection of not only flipped, but also complement and reverse-complement alleles. They will also remove ambiguous alleles.

- AST_Daya_30787307

Last Reviewed: 2020-07-29

The problem with this file was that I wasn't sure which beta and se to use. Chris suggested to use beta_0 and se_0, so I manually replaced those headers by BETA and SE, as well as assigning SNPID, ALT, REF, and P. Then I pipelined the dataset using pipeline v5.0


- SLE_Julia_29848360_1

Last Reviewed: 2020-08-12

This file is a meta-analysis that came with Z and P, but no BETA and SE. In order to compute those, I had to compute their allele frequencies, by first
manually replacing headers to CHR19,SNPID,BP19,REF,ALT,Z,P, and then 

./Compute_freqs.sh -f SLE_Julia_29848360_1.tsv.gz -p CEU

Then, I used R to compute its BETA and SE.


> jul <- fread("SLE_Julia_29848360_1-withfreqs.tsv.gz")
|--------------------------------------------------|
|==================================================|
> jul <- jul[!duplicated(jul$SNPID),]
> N = 13426
> s = 4943/N
> jul[,SE:= sqrt( 1 / (2 * N * ALT_FREQ * (1 - ALT_FREQ) * s * (1 - s)))][,BETA:=Z*SE]
> jul[, c("REF.1KG","ALT.1KG"):=NULL]
> fwrite(jul, "SLE_Julia_29848360_1-fixed.tsv.gz", sep = "\t")


- ANS_Li_30946743

Last Reviewed: 2020-08-20

These are three files: 1. Meta-analysis of Iranian and Turkish cohorts (this was the first file to be retrieved); 2. Iranian cohort, and 3. Turkish cohort.
These files had several problems: 1 lacked coordinates, 2 and 3 had only one allele reported.
For 1, Allele1 was identified as ALT, and Allele2 as REF, from information in the paper.
For 2 and 3, reported allele was considered as ALT, cross-checked with the paper.

When I started processing these files, I was building the GWAS_tools system, in order to apply all sorts of tools straight to 01-Workshop.
For 1 I used 00a-Missing_coords to compute its coordinates from 1000G.
For 2 and 3 I used 00b-Missing_one_allele/fix-one-allele-problem.sh, changing relevant column names accordingly.


- AST_Moffatt_20860503_1

Last Reviewed: 2020-08-25

This file was tricky to assign REF and ALT, and to choose which effect to use.
Finally, I chouse Allele_1 = REF, and Allele_2 = ALT. See README at 99 for more details about why this choice was made.
Regarding OR and P, I chose OR_fix and P_fix, following Chris' advice.

After these correction, I pipelined the file using v5.1.


- BEHD_Remmers_20622878_1

Last Reviewed: 2020-08-25

This file was especially tricky, because it was unclear to me REF/ALT distribution. This was worsened by the fact that paper did not inform about significant
SNPs coordiates, and the provided rs weren't in the file. It looks like the authors deposited the genomic data in dbGAP, and someone else did the GWAS of which summary statistics are available.
I wanted to try at least one shot before abandoning the file, so I used Allele1 = REF and Allele2 = ALT for the time being, so I could get hg38 coordinates and compare them with those of the SNPs reported in the paper. So I pipelined the file using v5.1.
The first attempt was unsucessful because the positions in the file were zero-based. I fixed this by writing a script to add one position to the position column:

Rscript --vanilla ../GWAS_tools/00c-Misplaced_coords/Update_positions.R BEHD_Remmers_20622878_1.tsv.gz Position 1

After this, I pipelined again, and the results looked better. Pipeline could correctly identify hg19 build and liftover to hg38. Although I managed to liftover it to hg38, I still couldn't find the crucial rs1518111 SNPs. Since there's not enough info in the paper to tell Ref and Alt alleles, I moved liftovered file to Specials and declared it abandoned.


- BPD_Smith_19488044_1

Last Reviewed: 2020-08-25

Could not tell ALT and REF alleles from the paper, as reported OR in the paper didn't match those in the data. File likely has other issues, based on my experience with this sort of "dbGAP" datasets (eg. zero-based), so I decided to declare it abandoned.


- CEC_Leo_28806749_1

Last Reviewed: 2020-08-25

This file lacked one allele, but fortunately it was in hg19, so I used 
../GWAS_tools/00b-Missing_one_allele/fix-one-allele-problem.sh CEC_Leo_28806749_1.tsv.gz
Working on CEC_Leo_28806749_1.tsv.gz
Extracting list of SNPs
Extracting both alleles from 1000 genomes data...
Computing the other allele...
CEC_Leo_28806749_1.tsv.gz has 277599 SNPs.
Processed CEC_Leo_28806749_1-fixed.tsv.gz has 276442 SNPs. Writing...
Done!

After that, I pipelined the file using v5.1.


- IBD_Duerr_17068223_1

Last Reviewed: 2020-08-25

This file, from dbGAP, corresponds to an extremely old paper (2006) on IBD in Jewish. I couldn't tell the effect and reference allele from the paper nor from the associated documentation, so I pronounced it abandoned.


- LADA_Cousminer_30254083_1

Last Reviewed: 2020-08-25

This file had only one allele reported. Despite being refered to as "reference allele", and this reference not matching the "reference" provided in the paper, it seems that OR refer to that "reference allele" in the data, since rs2476601 (1:114377568) has G and OR=0.582531, and we know that G is the protective allele. Thus I recode it to ALT.

../GWAS_tools/00b-Missing_one_allele/fix-one-allele-problem.sh LADA_Cousminer_30254083_1.tsv.gz

After that, I pipelined LADA_Cousminer_30254083_1-fixed.tsv.gz using v5.1.


- PSA_Aterido_30552173

Last Reviewed: 2020-08-25

I originally took these two files from the hpc GWAS_summary_data/. However, these files looked to be the result of imputation, and they didn't have OR or BETA, but multiple Z scores.
I decided to redownload the datasets from the Excel file in ftp://ftp.ebi.ac.uk/pub/databases/gwas/summary_statistics/AteridoA_30552173_GCST007043, split it into the two files, and process them. I updated those files in 97-Archive.


- T2D_Saxena_17463246_1

Last Reviewed: 2020-08-25

Original file in hg17. I downloaded the harmonised file, which had many missing files. 
I tried to use harmonised coordinates and the rest from the original file, but it had 4 SNP matches with IMD basis manifest. 
I declared this file abandoned.


- AST_Myers_24824216

Last Reviewed: 2020-08-26

These two files correspond to meta-analyses of African-American and Latino asthma patients and controls.
These had Z and P, but no BETA or OR, and they're in hg18, so I had to first liftover them to hg19, then compute ALT_FREQ, and then compute BETA from Z.

Since they correspond to meta-analyses, the allele frequency approach may not apply, since it makes sense when populations are more or less homogeneous. An assumption that is lost when dealing with a meta-analysis across different population. I'll wait for discussion to proceed.


- MS_IMSGC_17660530_1

Last Reviewed: 2020-08-26

This dataset is a dbGAP dataset. It corresponds to 609 family trios, 2322 case subjects, and 789 control subjects and used genotyping data from two external control data sets. 
As with other dbGAP datasets, this one proved difficult to tell REF/ALT alleles, since they don't match the "risk allele" logic in the paper (eg. Some SNPs have one named "risk allele" in the paper that corresponds to Allele1 in the dataset, and has OR<1, which would suggest that Allele2 is ALT, and Allele1 is REF. However, in other instances, the risk allele is Allele1, with OR>1, which would indicate that Allele1 is ALT).
Also, P-values and ORs don't match any of the values in the paper.
Being a very old study (2007), I decided to pronounce it abandoned.


- MS_Baranzini_19010793_1

Last Reviewed: 2020-08-26

This dataset is a dbGAP dataset. By checking the paper once more, I couldn't find out which to which allele OR corresponds to.
I searched for a README or manifest in dbGAP to find out if there's a general rule for Allele1/2 being REF or ALT, but to no avail.
Being also a very old study, I decided to pronounce it abandoned.


- SLE_Hom_18204098

Last Reviewed: 2020-08-26

This dataset is a dbGAP dataset. As with other dbGAP datasets, this one proved difficult to tell REF/ALT alleles, since they don't match the "risk/minor allele" logic in the paper (eg. Some SNPs have one named "risk/minor allele" in the paper that corresponds to Allele1 in the dataset, and has OR<1, which would suggest that Allele2 is ALT, and Allele1 is REF. However, in other instances, the risk allele is Allele1, with OR>1, which would indicate that Allele1 is ALT).
Also, some P-values and ORs don't match the values in the paper.
Being a very old study (2008), I decided to pronounce it abandoned.


- T2D_Scott_17463248_1

Last Reviewed: 2020-08-26

This dataset is a dbGAP dataset. As with other dbGAP datasets, this one proved difficult to tell REF/ALT alleles, since they don't match the "risk/minor allele" logic in the paper (eg. Some SNPs have one named "risk/minor allele" in the paper that corresponds to Allele1 in the dataset, and has OR<1, which would suggest that Allele2 is ALT, and Allele1 is REF. However, in other instances, the risk allele is Allele1, with OR>1, which would indicate that Allele1 is ALT).
Also, many SNPs in the paper seem to be missing from the dataset.
Being a very old study (2007), I decided to pronounce it abandoned.


- PID_Thaventhiram_32678341_1

Last Reviewed: 2020-09-16

The dataset had only one allele. So I applied GWAS_tools/00b-Missing_allele/fix-one-allele-problem-sh and then pipeline_v5.1.sh.


- AST_Myers_24824216

Last Reviewed: 2020-09-17

These 2 datasets correspond to females and males of an asthma GWAS comprising European, African-Americans and Latino populations, as well as a meta-analysis of all populations.
Files provide Z and P for each population, as well as hg18 coordinates.
To fix these files, I first renamed their coordinates to CHR18 and BP18, and changed extensions to .tsv.gz. Then I liftovered both to hg19 using
../GWAS_tools/02c-Backliftover_hg19/liftover-hg18-hg19.sh

Then I splitted the files using the code below, using the following numeration
- 1 EA (Males)
- 2 EA (Females)
- 3 AA (Males)
- 4 AA (Females)
- 5 Latino (Males)
- 6 Latino (Females)


library(data.table)

dsf  <- fread("AST_Myers_24824216_2-hg18with19.tsv.gz")
dsm  <- fread("AST_Myers_24824216_1-hg18with19.tsv.gz")


eurf <- dsf[, c("SNPID", "CHR18", "BP18","CHR19","BP19", "Host_Gene","A1", "A0", "EA.Z", "EA.p.value")]
eurm <- dsm[, c("SNPID", "CHR18", "BP18","CHR19","BP19", "Host_Gene","A1", "A0", "EA.Z", "EA.p.value")]
names(eurf)[c(7:10)] <- c("ALT","REF","Z","P")
names(eurm)[c(7:10)] <- c("ALT","REF","Z","P")
eurf <- na.omit(eurf)
eurm <- na.omit(eurm)

aaf <- dsf[, c("SNPID", "CHR18", "BP18","CHR19","BP19", "Host_Gene","A1", "A0", "AA.Z", "AA.p.value")]
aam <- dsm[, c("SNPID", "CHR18", "BP18","CHR19","BP19", "Host_Gene","A1", "A0", "AA.Z", "AA.p.value")]
names(aaf)[c(7:10)] <- c("ALT","REF","Z","P")
names(aam)[c(7:10)] <- c("ALT","REF","Z","P")
aaf <- na.omit(aaf)
aam <- na.omit(aam)

latf <- dsf[, c("SNPID", "CHR18", "BP18","CHR19","BP19", "Host_Gene","A1", "A0", "Latino.Z", "Latino.p.value")]
latm <- dsm[, c("SNPID", "CHR18", "BP18","CHR19","BP19", "Host_Gene","A1", "A0", "Latino.Z", "Latino.p.value")]
names(latf)[c(7:10)] <- c("ALT","REF","Z","P")
names(latm)[c(7:10)] <- c("ALT","REF","Z","P")
latf <- na.omit(latf)
latm <- na.omit(latm)

fwrite(eurm, "AST_Myers_24824216_1-split.tsv.gz", sep="\t")
fwrite(eurf, "AST_Myers_24824216_2-split.tsv.gz", sep="\t")
fwrite(aam, "AST_Myers_24824216_3-split.tsv.gz", sep="\t")
fwrite(aaf, "AST_Myers_24824216_4-split.tsv.gz", sep="\t")
fwrite(latm, "AST_Myers_24824216_5-split.tsv.gz", sep="\t")
fwrite(latf, "AST_Myers_24824216_6-split.tsv.gz", sep="\t")

Next step was to compute BETA/SE from Z. For that we'll need allele frequencies. Since we need to choose a reference population, we choose CEU for European Americans, ASW for African Americans/AfroCaribbean, and MXL for Latinos.

../GWAS_tools/02a-Missing_freqs/Compute_freqs.sh -f AST_Myers_24824216_1-split.tsv.gz -p CEU
../GWAS_tools/02a-Missing_freqs/Compute_freqs.sh -f AST_Myers_24824216_2-split.tsv.gz -p CEU
../GWAS_tools/02a-Missing_freqs/Compute_freqs.sh -f AST_Myers_24824216_3-split.tsv.gz -p ASW
../GWAS_tools/02a-Missing_freqs/Compute_freqs.sh -f AST_Myers_24824216_4-split.tsv.gz -p ASW
../GWAS_tools/02a-Missing_freqs/Compute_freqs.sh -f AST_Myers_24824216_5-split.tsv.gz -p MXL
../GWAS_tools/02a-Missing_freqs/Compute_freqs.sh -f AST_Myers_24824216_6-split.tsv.gz -p MXL

Once we have the frequencies, we can use ../GWAS_tools/02b-BETA_SE_from_Z/Compute_BETA_SE_from_Z.R.
We need to use the number of controls and cases, provided in the paper. Bear in mind that controls are pooled in each ancestry group

Rscript ../GWAS_tools/02b-BETA_SE_from_Z/Compute_BETA_SE_from_Z.R AST_Myers_24824216_1-withfreqs.tsv.gz 1535 1052
Rscript ../GWAS_tools/02b-BETA_SE_from_Z/Compute_BETA_SE_from_Z.R AST_Myers_24824216_2-withfreqs.tsv.gz 1535 1019
Rscript ../GWAS_tools/02b-BETA_SE_from_Z/Compute_BETA_SE_from_Z.R AST_Myers_24824216_3-withfreqs.tsv.gz 1503 675
Rscript ../GWAS_tools/02b-BETA_SE_from_Z/Compute_BETA_SE_from_Z.R AST_Myers_24824216_4-withfreqs.tsv.gz 1503 837
Rscript ../GWAS_tools/02b-BETA_SE_from_Z/Compute_BETA_SE_from_Z.R AST_Myers_24824216_5-withfreqs.tsv.gz 792 926
Rscript ../GWAS_tools/02b-BETA_SE_from_Z/Compute_BETA_SE_from_Z.R AST_Myers_24824216_6-withfreqs.tsv.gz 792 710 

Now we can run pipeline v5.1 (not before renaming CHR19/BP19 back to CHR/BP...)


- HBVV_Nishida_29534301_1

Last Reviewed: 2020-09-17

This dataset has lots of different columns, and it was unclear to me which ones to choose. After discussing the issue with Chris, we concluded that
slope = BETA, and Slope SE = SE. We can use them to compute P values, although they're provided.


library(data.table)

ds <- fread("RHB_Nishida_29534301_1.tsv.gz")
setnames(ds, old=c("Slope", "Slope SE"), new=c("BETA","SE"))
ds[,Z:=BETA/SE][,P:=2*pnorm(-abs(Z))]
# Now let's get the alleles
ds$`Reference Alleles A/B`  <- gsub("\\[","",ds$`Reference Alleles A/B`) 
ds$`Reference Alleles A/B`  <- gsub("\\]","",ds$`Reference Alleles A/B`) 
ds[,c("A","B"):=tstrsplit(`Reference Alleles A/B`, "/")]
ds[,ALT:=ifelse(`Minor Allele` == "A", A,B)][,REF:=ifelse(`Minor Allele` == "B", A,B)]
ds  <- na.omit(ds,cols="Chromosome")
ds[,c("A", "B"):=NULL]
setnames(ds,old=c("dbSNP RS ID", "Marker"), new=c("SNPID","Altmarkername"))
fwrite(ds, "HBVV_Nishida_29534301_1.tsv.gz", sep="\t")

- Vuckovic_32888494

Last Reviewed: 2020-09-24

These are 29 Blood cell traits GWAS datasets.
They didn't present any major issue, so I simply downloaded them, included metadata at Main_GWAS_table, pipelined (v5.1), adjusted sdY using

Rscript ../GWAS_tools/03bc-Convert_scales_adjust_sdY/Fix_scales_adjust_sdY.R


- Chen_32888493

Last Reviewed: 2020-09-24

These datasets correspond to 15 Blood cell trait multi-cohort and trans-ethnic meta-analysis.
They represent meta-analyses by cohort and trans-ethnic, so I used the following numbering for the files:
1 - AA - African/African American
2 - EA - European
3 - EAS - East Asian
4 - HA - Hispanic American/Latinos
5 - Trans - Trans-ethnic meta-analysis using GWAMA
6 - Trans - Trans-ethnic meta-analysis using MRMEGA

I used existing codes for traits, and included all relevant data in Main_GWAS_table.

Certain notes to bear in mind:
- Trans-ethnic meta-analyses included data from South Asian cohort (UKBB), which is not available as single-cohort.
- East Asian for RDW was not available.
- For sample sizes, I downloaded Table S1, I looked for the composition of each cohort, and summed sample sizes for each cohort. I considered totals (including South Asian) but not MVP cohort (used in replication) for Trans-ethnic meta-analysis sample size. I saved the modified excel file and uploaded to 99-Technical_files.

I downloaded all available from their original source, and checked the headers, as they were heterogeneous (see README_Chen_32888493.txt).
Also, GWAMA files showed to have rs_number as pids in CHR:BP_REF_ALT format, so I wrote a script for those cases: fix_chen.R

After fixing and pipelining (v5.1), I run Fix_scales_adjust_sdY for all 89 files.

- T1D_Inshaw_up_1

Last Reviewed: 2020-11-26

This dataset is a meta-analysis, and has minor_allele, and alleleA and alleleB columns. In most occasions alleleB matches the minor_allele, so if we assume that the effect allele is usually the minor allele, we can say that alleleA = REF and alleleB = ALT. I assigned REF/ALT according to this.

